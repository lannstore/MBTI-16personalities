<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16人格趣味测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind 配置
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        secondary: '#8B5CF6',
                        neutral: '#F3F4F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .gradient-bg {
                background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            }
            .gradient-card {
                background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            }
            .option-hover {
                transition: all 0.3s ease;
            }
            .option-hover:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.1);
            }
            .progress-bar {
                background: linear-gradient(90deg, #6366F1, #8B5CF6);
            }
            /* 优化毛玻璃效果 */
            .result-card {
                border-radius: 1.5rem;
                backdrop-filter: blur(15px) saturate(180%);
                -webkit-backdrop-filter: blur(15px) saturate(180%);
                background: rgba(255, 255, 255, 0.65);
                border: 1px solid rgba(209, 213, 219, 0.3);
            }
            /* 毛玻璃内容块 */
            .glass-block {
                backdrop-filter: blur(12px) saturate(160%);
                -webkit-backdrop-filter: blur(12px) saturate(160%);
                background: rgba(255, 255, 255, 0.75);
                border: 1px solid rgba(209, 213, 219, 0.2);
                border-radius: 1rem;
            }
            /* 修复按钮文字居中的样式 */
            .btn-center {
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            /* 修改1：AB选项卡描边加粗（从2px改为3px） */
            .option-selected {
                border: 3px solid #6366F1 !important;
                background-color: rgba(99, 102, 241, 0.1);
            }
            /* 优化头像容器，提升占比 */
            .avatar-container {
                width: 100%;
                height: 380px; /* 提升高度占比 */
                min-height: 320px;
                border-radius: 1.5rem;
                overflow: hidden;
                box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1);
            }
            .avatar-container img,
            .avatar-container svg {
                width: 100% !important;
                height: 100% !important;
                object-fit: cover;
            }
            /* 背景大图容器样式 - 移除高斯模糊等效果 */
            .bg-image-container {
                position: absolute;
                inset: 0;
                z-index: 0;
                overflow: hidden;
            }
            .bg-image-container img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                /* 移除所有效果：高斯模糊、透明度 */
            }
            /* 响应式调整 */
            @media (max-width: 768px) {
                .avatar-container {
                    height: 280px;
                    min-height: 250px;
                }
                .mobile-scale {
                    transform: scale(0.95);
                    transform-origin: top center;
                }
            }
            @media (max-width: 480px) {
                .avatar-container {
                    height: 240px;
                    min-height: 220px;
                }
                .mobile-scale {
                    transform: scale(0.9);
                    transform-origin: top center;
                }
            }
            .decor-line {
                height: 1px;
                background: currentColor;
                opacity: 0.3;
            }
            .decor-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: currentColor;
            }
            /* 添加hidden类定义 */
            .hidden {
                display: none;
            }
            /* 图片预加载样式 */
            .preload-image {
                position: absolute;
                width: 0;
                height: 0;
                opacity: 0;
                pointer-events: none;
            }
            /* 按钮对齐方案 */
            .button-group {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                justify-content: center;
                width: 100%;
            }
            .button-group button {
                flex: 1;
                min-width: 180px;
                max-width: 240px;
            }
            @media (max-width: 640px) {
                .button-group button {
                    flex: 1 0 100%;
                    max-width: 100%;
                }
            }
            /* 性别选择选项样式 - 新增动效圆形样式 */
            .gender-option {
                transition: all 0.3s ease;
                cursor: pointer;
            }
            .gender-option:hover {
                transform: translateY(-5px);
            }
            .gender-option.selected {
                border: 2px solid #6366F1;
                background-color: rgba(99, 102, 241, 0.1);
            }
            /* 性别图标圆形动效样式 */
            .gender-icon-circle {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
                transition: all 0.5s ease;
            }
            .gender-icon-circle::before {
                content: '';
                position: absolute;
                width: 150%;
                height: 150%;
                background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
                animation: spin 3s linear infinite;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .gender-icon-circle:hover {
                transform: scale(1.05) rotate(5deg);
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
            }
            .gender-icon-circle:hover::before {
                opacity: 1;
            }
            .gender-icon {
                font-size: 6xl !important;
                z-index: 1;
                transition: all 0.3s ease;
            }
            .gender-option:hover .gender-icon {
                transform: scale(1.1);
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* 弱化AB序号描边效果 */
            .ab-label {
                width: 40px !important;
                height: 40px !important;
                border: 1px solid rgba(99, 102, 241, 0.3) !important; /* 弱化描边 */
                background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important; /* 主题渐变色 */
                color: white !important;
                font-weight: bold !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
        }  
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800">
    <!-- 首页 -->
    <div id="home-container" class="container mx-auto px-4 py-8 max-w-4xl min-h-[80vh] flex flex-col justify-start items-center pt-4">
        <div class="gradient-card rounded-3xl p-10 shadow-xl w-full text-center">
            <div class="mb-8">
                <div class="inline-block p-4 rounded-full gradient-bg mb-6">
                    <i class="fa fa-user-circle-o text-5xl text-white"></i>
                </div>
                <h1 class="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">16人格趣味测试</h1>
                <p class="text-xl text-slate-600 max-w-2xl mx-auto">
                    通过36道趣味题目，探索你的人格特质，了解真实的自己，发现独特的性格优势
                </p>
            </div>
            
            <div class="space-y-6 max-w-md mx-auto text-left">
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-primary mt-1 mr-3 text-xl"></i>
                    <div>
                        <h3 class="font-semibold text-lg">专业维度</h3>
                        <p class="text-slate-500">基于经典16人格理论，从4个维度解析你的性格</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-primary mt-1 mr-3 text-xl"></i>
                    <div>
                        <h3 class="font-semibold text-lg">趣味体验</h3>
                        <p class="text-slate-500">轻松有趣的题目，无需专业知识也能参与</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-primary mt-1 mr-3 text-xl"></i>
                    <div>
                        <h3 class="font-semibold text-lg">详细报告</h3>
                        <p class="text-slate-500">生成专属人格画像，了解优势与改进方向</p>
                    </div>
                </div>
            </div>
            
            <button id="start-btn" class="mt-10 px-10 py-4 rounded-2xl gradient-bg text-white font-medium text-lg btn-center w-full max-w-md hover:shadow-lg transition-all">
                <i class="fa fa-play-circle mr-2"></i>开始测试
            </button>
        </div>
        
        <p class="mt-8 text-slate-500 text-sm">
            测试仅供娱乐，结果不代表专业心理评估
        </p>
    </div>

    <!-- 性别选择页面 - 修改性别图标为动效圆形 -->
    <div id="gender-container" class="container mx-auto px-4 py-8 max-w-4xl min-h-[80vh] flex flex-col justify-start items-center pt-4 hidden">
        <div class="gradient-card rounded-3xl p-10 shadow-xl w-full text-center">
            <div class="mb-8">
                <div class="inline-block p-4 rounded-full gradient-bg mb-6">
                    <i class="fa fa-venus-mars text-5xl text-white"></i>
                </div>
                <h1 class="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">选择你的性别</h1>
                <p class="text-xl text-slate-600 max-w-2xl mx-auto">
                    选择性别后将为你生成更贴合的人格画像
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto mb-10">
                <!-- 男性选项 - 修改图标容器为动效圆形 -->
                <div id="male-option" class="gender-option glass-block p-8 rounded-2xl">
                    <div class="gender-icon-circle bg-blue-100 mx-auto mb-4">
                        <i class="fa fa-mars gender-icon text-blue-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">男性</h3>
                    <p class="text-slate-500">为你匹配男性视角的人格解析</p>
                </div>
                
                <!-- 女性选项 - 修改图标容器为动效圆形 -->
                <div id="female-option" class="gender-option glass-block p-8 rounded-2xl">
                    <div class="gender-icon-circle bg-pink-100 mx-auto mb-4">
                        <i class="fa fa-venus gender-icon text-pink-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">女性</h3>
                    <p class="text-slate-500">为你匹配女性视角的人格解析</p>
                </div>
            </div>
            
            <button id="confirm-gender-btn" class="mt-4 px-10 py-4 rounded-2xl gradient-bg text-white font-medium text-lg btn-center w-full max-w-md hover:shadow-lg transition-all opacity-50 cursor-not-allowed" disabled>
                <i class="fa fa-arrow-right mr-2"></i>确认选择
            </button>
        </div>
        
        <p class="mt-8 text-slate-500 text-sm">
            测试仅供娱乐，结果不代表专业心理评估
        </p>
    </div>

    <!-- 测试页面 -->
    <div id="test-container" class="container mx-auto px-4 py-8 max-w-3xl hidden">
        <!-- 进度条 -->
        <div class="w-full h-2 bg-slate-200 rounded-full mb-8 overflow-hidden">
            <div id="progress-bar" class="progress-bar h-full w-0 transition-all duration-300"></div>
        </div>
        
        <!-- 题目区域 -->
        <div class="gradient-card rounded-3xl p-8 shadow-lg mb-8">
            <div class="text-lg text-slate-500 mb-2" id="question-number">第 1 题 / 共 36 题</div>
            <div class="text-2xl font-bold mb-8" id="question-text">加载中...</div>
            
            <!-- 选项区域 -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 选项会通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 导航按钮 -->
        <div class="flex justify-between items-center">
            <button id="prev-btn" class="px-6 py-3 rounded-2xl gradient-bg text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed btn-center" disabled>
                <i class="fa fa-arrow-left mr-2"></i>上一题
            </button>
            <button id="next-btn" class="px-6 py-3 rounded-2xl gradient-bg text-white font-medium btn-center">
                下一题<i class="fa fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <!-- 结果页面（核心优化） -->
    <div id="result-container" class="container mx-auto px-4 py-8 max-w-5xl hidden">
        <!-- 主结果卡片 - 底图+毛玻璃布局 -->
        <div id="result-card-main" class="relative rounded-3xl overflow-hidden shadow-2xl mb-8">
            <!-- 修改2：背景大图链接更换为2背景.jpg -->
            <div id="bg-image-container" class="bg-image-container">
                <img src="https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/2%E8%83%8C%E6%99%AF.jpg" alt="背景图" crossorigin="anonymous">
            </div>
            
            <!-- 内容层 - 毛玻璃容器 -->
            <div class="relative z-10 p-6 md:p-8 lg:p-10">
                <div class="flex flex-col lg:flex-row gap-6 lg:gap-10 items-center lg:items-start">
                    <!-- 左侧头像区域（大幅提升占比） -->
                    <div class="lg:w-3/5 w-full">
                        <div id="personality-avatar" class="avatar-container mx-auto"></div>
                        <!-- 装饰点 -->
                        <div class="flex justify-center mt-6 space-x-3">
                            <div class="decor-dot text-primary"></div>
                            <div class="decor-dot text-primary"></div>
                            <div class="decor-dot text-primary"></div>
                       </div>
                    </div>
                    
                    <!-- 右侧内容区域（毛玻璃分块） -->
                    <div class="lg:w-2/5 w-full space-y-6">
                        <!-- 人格标题块 -->
                        <div class="glass-block p-6">
                            <div class="flex items-center mb-4">
                                <div id="color-indicator" class="w-12 h-12 rounded-full mr-4 shadow-lg"></div>
                                <h2 id="personality-title" class="text-2xl md:text-3xl font-bold"></h2>
                            </div>
                            <!-- 角色画像 -->
                            <div>
                                <h3 class="text-xl font-semibold mb-3 text-primary flex items-center">
                                    <i class="fa fa-user-circle-o mr-2"></i>角色画像 
                                    <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                                </h3>
                                <p id="personality-portrait" class="text-slate-600 leading-relaxed text-lg"></p>
                            </div>
                        </div>
                        
                        <!-- 优势与不足 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="glass-block p-5">
                                <h3 class="text-lg font-semibold mb-3 text-primary flex items-center">
                                    <i class="fa fa-star-o mr-2"></i>优势 
                                    <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                                </h3>
                                <ul id="personality-strengths" class="text-slate-600 list-disc list-inside space-y-2 text-sm md:text-base"></ul>
                            </div>
                            <div class="glass-block p-5">
                                <h3 class="text-lg font-semibold mb-3 text-primary flex items-center">
                                    <i class="fa fa-exclamation-circle mr-2"></i>不足 
                                    <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                                </h3>
                                <ul id="personality-weaknesses" class="text-slate-600 list-disc list-inside space-y-2 text-sm md:text-base"></ul>
                            </div>
                        </div>
                        
                        <!-- 深度分析 -->
                        <div class="glass-block p-6">
                            <h3 class="text-lg font-semibold mb-3 text-primary flex items-center">
                                <i class="fa fa-bar-chart mr-2"></i>深度分析 
                                <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                            </h3>
                            <div id="personality-deep-analysis" class="text-slate-600 leading-relaxed text-sm md:text-base space-y-3"></div>
                        </div>
                        
                        <!-- 性格领域 + 改进建议 -->
                        <div class="grid grid-cols-1 gap-4">
                            <div class="glass-block p-5">
                                <h3 class="text-lg font-semibold mb-3 text-primary flex items-center">
                                    <i class="fa fa-briefcase mr-2"></i>性格领域 
                                    <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                                </h3>
                                <div id="personality-suitable-fields" class="text-slate-600 leading-relaxed text-sm md:text-base"></div>
                            </div>
                            <div class="glass-block p-5">
                                <h3 class="text-lg font-semibold mb-3 text-primary flex items-center">
                                    <i class="fa fa-lightbulb-o mr-2"></i>改进建议 
                                    <div class="decor-line text-primary/50 ml-3 flex-1"></div>
                                </h3>
                                <p id="personality-suggestions" class="text-slate-600 leading-relaxed text-sm md:text-base"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 操作按钮 - 更新对齐方案 -->
        <div class="button-group">
            <button id="save-btn" class="px-8 py-4 rounded-2xl gradient-bg text-white font-medium btn-center hover:shadow-lg transition-all">
                <i class="fa fa-download mr-2"></i>保存到本地
            </button>
            <button id="restart-btn" class="px-8 py-4 rounded-2xl bg-slate-200 text-slate-800 font-medium btn-center hover:shadow-lg transition-all">
                <i class="fa fa-refresh mr-2"></i>重新测试
            </button>
        </div>
    </div>

    <!-- 图片预加载容器 -->
    <div id="image-preloader" class="preload-image"></div>

    <script>
        // 全局变量
        let currentQuestionIndex = 0;
        let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let userAnswers = new Array(36).fill(null);
        let currentPersonalityType = '';
        let selectedGender = ''; // 新增：选中的性别
        let autoNextTimer = null; // 自动跳转定时器
        
        // 题库数据
        const questions = [
            { id: 1, text: "周末计划被打乱时，你的第一反应是？", options: [
                { text: "烦躁，想尽快恢复原计划", score: { J: 2, P: 0 } },
                { text: "无所谓，随机应变反而更有趣", score: { J: 0, P: 2 } }
            ]},
            { id: 2, text: "和朋友聊天时，你更倾向于？", options: [
                { text: "分享最近的经历和感受", score: { E: 2, I: 0 } },
                { text: "倾听对方的故事，偶尔回应", score: { E: 0, I: 2 } }
            ]},
            { id: 3, text: "做决定时，你更依赖？", options: [
                { text: "理性分析和逻辑判断", score: { T: 2, F: 0 } },
                { text: "直觉感受和他人情绪", score: { T: 0, F: 2 } }
            ]},
            { id: 4, text: "面对新环境，你会？", options: [
                { text: "先观察了解，再慢慢融入", score: { S: 2, N: 0 } },
                { text: "立刻探索，想象各种可能性", score: { S: 0, N: 2 } }
            ]},
            { id: 5, text: "收到即时消息，你会？", options: [
                { text: "立刻回复，不喜欢拖延", score: { J: 2, P: 0 } },
                { text: "先忙自己的事，有空再回", score: { J: 0, P: 2 } }
            ]},
            { id: 6, text: "聚会结束后，你感觉？", options: [
                { text: "精力充沛，还想继续玩", score: { E: 2, I: 0 } },
                { text: "需要独处充电，感到疲惫", score: { E: 0, I: 2 } }
            ]},
            { id: 7, text: "评价电影时，你更看重？", options: [
                { text: "剧情逻辑和细节合理性", score: { S: 2, N: 0 } },
                { text: "整体意境和想象空间", score: { S: 0, N: 2 } }
            ]},
            { id: 8, text: "朋友吵架，你会？", options: [
                { text: "客观分析对错，给出建议", score: { T: 2, F: 0 } },
                { text: "先安抚情绪，再慢慢沟通", score: { T: 0, F: 2 } }
            ]},
            { id: 9, text: "学习新技能，你会？", options: [
                { text: "制定详细计划，按步骤学习", score: { J: 2, P: 0 } },
                { text: "边学边试，遇到问题再调整", score: { J: 0, P: 2 } }
            ]},
            { id: 10, text: "空闲时间，你更想？", options: [
                { text: "和朋友出去玩，热闹一下", score: { E: 2, I: 0 } },
                { text: "宅在家里，做自己喜欢的事", score: { E: 0, I: 2 } }
            ]},
            { id: 11, text: "解决问题时，你会？", options: [
                { text: "基于现有经验和事实", score: { S: 2, N: 0 } },
                { text: "尝试创新方法，跳出框架", score: { S: 0, N: 2 } }
            ]},
            { id: 12, text: "买东西时，你会？", options: [
                { text: "对比性价比，理性选择", score: { T: 2, F: 0 } },
                { text: "凭感觉喜欢，感性决策", score: { T: 0, F: 2 } }
            ]},
            { id: 13, text: "旅行前，你会？", options: [
                { text: "做好详细攻略，预订好一切", score: { J: 2, P: 0 } },
                { text: "只定大致方向，随缘探索", score: { J: 0, P: 2 } }
            ]},
            { id: 14, text: "遇到陌生人，你会？", options: [
                { text: "主动搭话，轻松建立联系", score: { E: 2, I: 0 } },
                { text: "保持距离，熟悉后才放开", score: { E: 0, I: 2 } }
            ]},
            { id: 15, text: "看待未来，你更？", options: [
                { text: "关注实际可实现的目标", score: { S: 2, N: 0 } },
                { text: "充满幻想，期待各种可能", score: { S: 0, N: 2 } }
            ]},
            { id: 16, text: "团队合作中，你更？", options: [
                { text: "注重效率和结果", score: { T: 2, F: 0 } },
                { text: "注重氛围和人际关系", score: { T: 0, F: 2 } }
            ]},
            { id: 17, text: "工作习惯上，你？", options: [
                { text: "喜欢提前完成，避免赶截止日期", score: { J: 2, P: 0 } },
                { text: "习惯最后冲刺，压力下效率更高", score: { J: 0, P: 2 } }
            ]},
            { id: 18, text: "情绪低落时，你会？", options: [
                { text: "找人倾诉，获得安慰", score: { E: 2, I: 0 } },
                { text: "自我消化，独处冷静", score: { E: 0, I: 2 } }
            ]},
            { id: 19, text: "阅读偏好，你更喜欢？", options: [
                { text: "纪实、实用类书籍", score: { S: 2, N: 0 } },
                { text: "科幻、幻想类书籍", score: { S: 0, N: 2 } }
            ]},
            { id: 20, text: "批评他人时，你会？", options: [
                { text: "直接指出问题，就事论事", score: { T: 2, F: 0 } },
                { text: "委婉表达，顾及对方感受", score: { T: 0, F: 2 } }
            ]},
            { id: 21, text: "整理物品时，你会？", options: [
                { text: "分类清晰，井然有序", score: { J: 2, P: 0 } },
                { text: "随性摆放，只要自己能找到", score: { J: 0, P: 2 } }
            ]},
            { id: 22, text: "社交能量来源是？", options: [
                { text: "和他人互动", score: { E: 2, I: 0 } },
                { text: "独自思考", score: { E: 0, I: 2 } }
            ]},
            { id: 23, text: "记忆特点是？", options: [
                { text: "擅长记住具体细节和事实", score: { S: 2, N: 0 } },
                { text: "擅长记住整体框架和概念", score: { S: 0, N: 2 } }
            ]},
            { id: 24, text: "决策风格是？", options: [
                { text: "依据原则和公平性", score: { T: 2, F: 0 } },
                { text: "依据人情和特殊性", score: { T: 0, F: 2 } }
            ]},
            { id: 25, text: "面对变化，你？", options: [
                { text: "需要时间适应，喜欢稳定", score: { J: 2, P: 0 } },
                { text: "乐于尝试，适应能力强", score: { J: 0, P: 2 } }
            ]},
            { id: 26, text: "表达想法时，你？", options: [
                { text: "喜欢多说，边说边整理思路", score: { E: 2, I: 0 } },
                { text: "先想清楚，再简洁表达", score: { E: 0, I: 2 } }
            ]},
            { id: 27, text: "兴趣爱好偏向？", options: [
                { text: "动手实践类（烹饪、手工）", score: { S: 2, N: 0 } },
                { text: "创意想象类（绘画、写作）", score: { S: 0, N: 2 } }
            ]},
            { id: 28, text: "处理冲突时，你？", options: [
                { text: "追求公正，不怕直面问题", score: { T: 2, F: 0 } },
                { text: "追求和谐，尽量避免冲突", score: { T: 0, F: 2 } }
            ]},
            { id: 29, text: "时间管理上，你？", options: [
                { text: "严格遵守时间表", score: { J: 2, P: 0 } },
                { text: "灵活调整，顺其自然", score: { J: 0, P: 2 } }
            ]},
            { id: 30, text: "聚会中，你通常是？", options: [
                { text: "活跃气氛的中心人物", score: { E: 2, I: 0 } },
                { text: "安静观察的旁观者", score: { E: 0, I: 2 } }
            ]},
            { id: 31, text: "解决难题时，你？", options: [
                { text: "一步一步分析解决", score: { S: 2, N: 0 } },
                { text: "先找整体思路，再填细节", score: { S: 0, N: 2 } }
            ]},
            { id: 32, text: "职业选择更看重？", options: [
                { text: "发展前景和薪资待遇", score: { T: 2, F: 0 } },
                { text: "兴趣爱好和工作氛围", score: { T: 0, F: 2 } }
            ]},
            { id: 33, text: "购物习惯是？", options: [
                { text: "列清单，按计划购买", score: { J: 2, P: 0 } },
                { text: "即兴购买，看到喜欢就买", score: { J: 0, P: 2 } }
            ]},
            { id: 34, text: "获取能量的方式是？", options: [
                { text: "外出社交，接触新鲜事物", score: { E: 2, I: 0 } },
                { text: "居家休息，享受安静时光", score: { E: 0, I: 2 } }
            ]},
            { id: 35, text: "思考方式偏向？", options: [
                { text: "具体、实际、当下", score: { S: 2, N: 0 } },
                { text: "抽象、理论、未来", score: { S: 0, N: 2 } }
            ]},
            { id: 36, text: "生活态度更倾向？", options: [
                { text: "理性规划，掌控生活", score: { T: 2, F: 0 } },
                { text: "感性体验，享受生活", score: { T: 0, F: 2 } }
            ]}
        ];

        // 修改4：重构头像生成函数，支持所有16种人格类型的头像链接
        function createAvatarImg(gender, personalityType) {
            // 定义所有人格类型的头像链接
            const avatarUrls = {
                INFP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infp-g.jpg'
                },
                ENFP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfp-g.jpg'
                },
                ENTJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entj-g.jpg'
                },
                ENTP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entp-g.jpg'
                },
                ESFJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfj-g.jpg'
                },
                ESFP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfp-g.jpg'
                },
                ESTJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estj-g.jpg'
                },
                ESTP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estp-g.jpg'
                },
                INFJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infj-g.jpg'
                },
                INTJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intj-g.jpg'
                },
                INTP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intp-g.jpg'
                },
                ISFJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfj-g.jpg'
                },
                ISFP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfp-g.jpg'
                },
                ISTJ: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istj-g.jpg'
                },
                ISTP: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istp-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istp-g.jpg'
                },
                // 默认头像（防止遗漏）
                default: {
                    male: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfj-b.jpg',
                    female: 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfj-g.jpg'
                }
            };
            
            // 获取对应人格类型的头像链接，没有则使用默认
            const avatarUrl = avatarUrls[personalityType] 
                ? avatarUrls[personalityType][gender] 
                : avatarUrls.default[gender];
                
            return `<img src="${avatarUrl}" alt="${gender === 'male' ? '男性人格头像' : '女性人格头像'}" class="w-full h-full object-cover rounded-3xl" crossorigin="anonymous"/>`;
        }

        // 修改3：更新统一背景图地址为2背景.jpg
        const COMMON_BG_IMAGE_URL = 'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/2%E8%83%8C%E6%99%AF.jpg';

        // 16人格类型数据（更新：统一背景图、移除"适合领域："前缀、标题改为性格领域）
        const personalityTypes = {
            ISTJ: {
                name: "物流师型 - 实际的组织者",
                color: "#3B82F6",
                portrait: "你是一个注重实际、责任感强的人，喜欢秩序和稳定，做事严谨可靠，是团队中值得信赖的执行者。",
                strengths: ["责任心强", "稳重可靠", "逻辑清晰", "注重细节"],
                weaknesses: ["过于保守", "不擅变通", "情感表达不足", "对变化敏感"],
                suggestions: "尝试接受不确定性，偶尔跳出舒适区；学会表达自己的情感，多倾听他人的创新想法。",
                deepAnalysis: [
                    "你天生具备极强的责任感和可靠性，承诺的事情一定会尽力完成，是团队中最值得托付的人。",
                    "你对规则和秩序有天然的偏好，善于建立和维护稳定的工作流程，确保一切按部就班。",
                    "你注重实际和实用，不喜欢虚无缥缈的幻想，做决策时更依赖经验和事实而非直觉。",
                    "在人际关系中，你虽然不擅长表达情感，但会用实际行动来关心和支持身边的人。"
                ],
                suitableFields: "会计、审计、工程、法律、行政管理、物流管理、质量控制、军警等需要严谨和责任心的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ISFJ: {
                name: "守卫者型 - 专注的保护者",
                color: "#10B981",
                portrait: "你是一个富有同情心、细心体贴的人，乐于照顾他人，重视和谐与稳定，是亲友们的坚实后盾。",
                strengths: ["富有爱心", "耐心细致", "忠诚可靠", "乐于助人"],
                weaknesses: ["过度付出", "害怕冲突", "缺乏自信", "难以拒绝他人"],
                suggestions: "学会设定边界，优先照顾自己的需求；增强自我肯定，勇敢表达自己的想法和感受。",
                deepAnalysis: [
                    "你拥有极强的共情能力，能敏锐感知他人的情绪和需求，总是愿意伸出援手帮助有需要的人。",
                    "你重视人际关系的和谐，会尽力避免冲突，愿意为了维持和平而做出让步和妥协。",
                    "你对身边的人充满责任感，尤其关心家人和朋友的福祉，是亲友圈中的守护者和照顾者。",
                    "你注重细节和实用性，善于把日常事务打理得井井有条，让生活和工作环境温馨而有序。"
                ],
                suitableFields: "护理、教育、社会工作、人力资源、客服、行政助理、医疗保健、餐饮服务等需要关怀和耐心的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            INFJ: {
                name: "提倡者型 - 安静的理想主义者",
                color: "#8B5CF6",
                portrait: "你是一个富有洞察力、充满理想的人，善于思考人生意义，致力于帮助他人成长，拥有强大的直觉和共情能力。",
                strengths: ["洞察力强", "富有创意", "坚定执着", "善于共情"],
                weaknesses: ["过度思考", "容易疲惫", "完美主义", "难以放下"],
                suggestions: "学会活在当下，避免过度思虑；接受不完美，给自己和他人更多包容。",
                deepAnalysis: [
                    "你拥有罕见的洞察力，能看透事物的本质和他人的真实动机，常常被称为灵魂的知己。",
                    "你是坚定的理想主义者，有自己的人生信仰和价值观，愿意为了追求意义和价值而付出努力。",
                    "你的直觉能力极强，往往能在信息不完整的情况下做出正确的判断和决策。",
                    "你渴望深度的、有意义的人际关系，虽然社交圈不大，但每一段关系都非常真挚和深刻。"
                ],
                suitableFields: "心理咨询、教育、写作、哲学、艺术、公益事业、人力资源、管理咨询等需要洞察力和共情能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            INTJ: {
                name: "建筑师型 - 富有想象力的战略家",
                color: "#EF4444",
                portrait: "你是一个富有逻辑、极具战略眼光的人，善于规划未来，追求创新和效率，是天生的问题解决者和领导者。",
                strengths: ["逻辑缜密", "战略思维", "创新能力", "独立自主"],
                weaknesses: ["过于理性", "缺乏耐心", "挑剔苛刻", "社交淡漠"],
                suggestions: "学会关注他人情感，增加人际温度；放慢节奏，欣赏过程中的美好。",
                deepAnalysis: [
                    "你拥有卓越的战略思维和长远眼光，善于制定复杂的计划并预见可能的结果，是天生的战略家。",
                    "你的逻辑思维能力极强，能快速分析问题、识别模式，并找到最有效的解决方案。",
                    "你追求创新和改进，不满足于现状，总是思考如何让事情变得更好、更高效。",
                    "你独立自主，不依赖他人的认可，有自己的判断标准，敢于坚持自己的想法即使面对反对。"
                ],
                suitableFields: "科学研究、技术研发、企业管理、金融分析、战略规划、法律、工程设计、创业等需要战略思维的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ISTP: {
                name: "鉴赏家型 - 大胆的实验家",
                color: "#F59E0B",
                portrait: "你是一个务实、灵活的人，善于动手解决问题，喜欢探索和体验新事物，拥有敏锐的观察力和快速反应能力。",
                strengths: ["动手能力强", "适应性好", "务实高效", "冷静理性"],
                weaknesses: ["缺乏耐心", "不喜规划", "情感迟钝", "容易厌倦"],
                suggestions: "学会长期坚持，培养深度兴趣；关注他人感受，增强情感连接。",
                deepAnalysis: [
                    "你是天生的动手达人，擅长解决实际问题，能快速理解机械和系统的工作原理并进行修复。",
                    "你适应性极强，能迅速应对突发情况和变化，在压力下依然保持冷静和高效。",
                    "你注重当下的体验和实用价值，不喜欢空谈理论，更愿意通过实践和尝试来学习。",
                    "你好奇心强，喜欢探索新事物和新方法，对机械、技术和户外活动有天然的兴趣。"
                ],
                suitableFields: "机械工程、电子技术、计算机维修、运动教练、军警、消防员、手工艺、贸易、创业等需要动手能力和应变能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ISFP: {
                name: "探险家型 - 灵活的艺术家",
                color: "#EC4899",
                portrait: "你是一个温柔、敏感的人，热爱生活和美好事物，善于用行动表达情感，享受当下的每一个瞬间。",
                strengths: ["艺术天赋", "温柔体贴", "真诚坦率", "活在当下"],
                weaknesses: ["避免冲突", "缺乏规划", "过于敏感", "难以坚持"],
                suggestions: "学会面对挑战，表达真实想法；制定简单计划，平衡随性与目标。",
                deepAnalysis: [
                    "你拥有敏锐的审美和艺术天赋，能发现生活中的美，并通过各种形式表达自己的创造力。",
                    "你注重个人体验和感受，活在当下，享受生活中的小确幸，不喜欢被规则和计划束缚。",
                    "你真诚坦率，忠于自己的内心感受，不喜欢虚伪和做作，待人接物都非常真实。",
                    "你虽然不善于用语言表达情感，但会通过行动、礼物或创造来表达对他人的关心和爱意。"
                ],
                suitableFields: "艺术设计、音乐、摄影、烹饪、美容、时尚、体育、康复治疗、园艺等需要创造力和审美能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            INFP: {
                name: "调停者型 - 充满诗意的理想主义者",
                color: "#6366F1",
                portrait: "你是一个富有创造力、充满理想的人，内心丰富敏感，重视个人价值和意义，致力于追求真实和美好。",
                strengths: ["创造力强", "富有同理心", "真诚善良", "坚持初心"],
                weaknesses: ["过度敏感", "逃避现实", "优柔寡断", "自我否定"],
                suggestions: "学会接纳现实，增强抗压能力；相信自己的价值，勇敢行动。",
                deepAnalysis: [
                    "你拥有丰富的内心世界和强大的想象力，常常沉浸在自己的思考和幻想中，是天生的梦想家和理想主义者。",
                    "你对自己的价值观和信仰非常执着，不愿意为了迎合他人而妥协自己的原则和初心。",
                    "你的共情能力极强，能深刻理解他人的情感和痛苦，是绝佳的倾听者和安慰者。",
                    "你富有创造力和诗意，善于用文字、艺术等形式表达自己的内心感受和对世界的理解。"
                ],
                suitableFields: "写作、编辑、艺术、音乐、心理咨询、教育、公益、翻译、哲学等需要创造力和共情能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            INTP: {
                name: "逻辑学家型 - 创新的发明家",
                color: "#14B8A6",
                portrait: "你是一个富有逻辑、热爱思考的人，喜欢探索抽象概念，拥有极强的分析能力和创新思维。",
                strengths: ["逻辑思维", "创新能力", "好奇心强", "独立思考"],
                weaknesses: ["社交淡漠", "过度分析", "拖延症", "不切实际"],
                suggestions: "学会行动起来，将想法落地；关注现实需求，平衡理论与实践。",
                deepAnalysis: [
                    "你拥有极强的逻辑思维和分析能力，能快速识别问题的核心并找到创新的解决方案。",
                    "你对知识和真理有强烈的追求，喜欢探索抽象概念和理论，常常沉浸在自己的思考世界中。",
                    "你独立思考，不盲从权威，总是质疑现有的规则和方法，寻找更优的解决方案。",
                    "你虽然在社交场合中显得内向和淡漠，但在自己感兴趣的领域能展现出惊人的热情和专注。"
                ],
                suitableFields: "科学研究、编程开发、学术研究、哲学、数学、工程设计、咨询等需要逻辑思维和创新能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ESTP: {
                name: "企业家型 - 精力充沛的感知者",
                color: "#F97316",
                portrait: "你是一个充满活力、勇于冒险的人，善于把握机会，享受行动和挑战带来的乐趣。",
                strengths: ["行动力强", "适应性好", "乐观开朗", "务实高效"],
                weaknesses: ["缺乏耐心", "冲动行事", "不喜规划", "责任感弱"],
                suggestions: "学会三思而后行，考虑后果；培养长期目标，平衡即时满足与长远发展。",
                deepAnalysis: [
                    "你充满活力和热情，喜欢行动和冒险，享受挑战和变化带来的刺激和乐趣。",
                    "你善于把握当下的机会，能快速做出决策并采取行动，是天生的行动派和实践者。",
                    "你乐观开朗，善于交际，能轻松融入各种社交场合，是团队中的气氛制造者。",
                    "你注重实际效果和实用价值，不喜欢空谈理论，更愿意通过实践来验证想法。"
                ],
                suitableFields: "销售、市场营销、创业、演艺、体育、公关、旅游、贸易等需要行动力和社交能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ESFP: {
                name: "表演者型 - 热情的艺人",
                color: "#EC4899",
                portrait: "你是一个热情洋溢、善于表达的人，享受他人的关注和赞美，用快乐感染身边的每一个人。",
                strengths: ["热情开朗", "善于表达", "富有魅力", "活在当下"],
                weaknesses: ["缺乏深度", "冲动行事", "害怕独处", "逃避问题"],
                suggestions: "学会深度思考，培养内在成长；面对问题而非逃避，增强抗压能力。",
                deepAnalysis: [
                    "你热情洋溢，善于表达和表演，享受成为众人焦点的感觉，是天生的艺人。",
                    "你拥有极强的社交能力和魅力，能轻松赢得他人的喜爱和认可，善于营造欢乐的氛围。",
                    "你注重当下的快乐和体验，喜欢新鲜有趣的事物，不喜欢枯燥和重复的工作。",
                    "你富有同情心，能敏锐感知他人的情绪，愿意用自己的快乐感染和帮助他人。"
                ],
                suitableFields: "演艺、销售、公关、旅游、餐饮、时尚、美容、教育等需要表达能力和社交能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ENFP: {
                name: "竞选者型 - 热情的理想主义者",
                color: "#8B5CF6",
                portrait: "你是一个富有创意、充满热情的人，善于发现他人的潜力，用灵感和热情激励身边的人。",
                strengths: ["富有创意", "热情洋溢", "善于激励", "乐观向上"],
                weaknesses: ["缺乏耐心", "虎头蛇尾", "过度乐观", "逃避冲突"],
                suggestions: "学会坚持到底，将想法落地；面对现实问题，平衡理想与实际。",
                deepAnalysis: [
                    "你富有创造力和想象力，能产生各种新奇的想法和创意，善于启发和激励他人。",
                    "你热情洋溢，对生活充满好奇和期待，总是能发现事物积极的一面，是天生的乐观主义者。",
                    "你善于理解和欣赏他人的优点和潜力，能很好地激励和鼓舞团队成员发挥最佳水平。",
                    "你渴望深度和有意义的人际关系，虽然社交圈广，但依然重视真挚和深刻的连接。"
                ],
                suitableFields: "教育、心理咨询、创意策划、公关、创业、写作、艺术、公益等需要创造力和激励能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ENTP: {
                name: "辩论家型 - 聪明的创新者",
                color: "#F59E0B",
                portrait: "你是一个思维敏捷、善于辩论的人，喜欢挑战传统，用智慧和创意解决复杂问题。",
                strengths: ["思维敏捷", "口才出众", "创新能力", "适应力强"],
                weaknesses: ["缺乏耐心", "喜欢抬杠", "责任感弱", "虎头蛇尾"],
                suggestions: "学会倾听他人，尊重不同观点；培养责任感，将创意转化为实际成果。",
                deepAnalysis: [
                    "你思维敏捷，口才出众，喜欢辩论和智力挑战，能快速发现他人观点中的漏洞。",
                    "你富有创新精神和批判性思维，不盲从传统和权威，总是寻找更好的解决方案。",
                    "你适应能力强，能快速应对变化和挑战，在复杂的环境中依然保持冷静和机智。",
                    "你好奇心强，对各种知识和想法都感兴趣，善于将不同领域的概念结合起来创造新事物。"
                ],
                suitableFields: "律师、销售、创业、咨询、媒体、广告、科研、技术等需要思维敏捷和创新能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ESTJ: {
                name: "总经理型 - 高效的管理者",
                color: "#3B82F6",
                portrait: "你是一个务实高效、善于组织的人，喜欢掌控局面，用逻辑和秩序带领团队取得成功。",
                strengths: ["组织能力强", "务实高效", "责任心强", "果断决策"],
                weaknesses: ["过于强势", "缺乏变通", "情感迟钝", "固执己见"],
                suggestions: "学会倾听他人意见，灵活变通；关注团队成员情感，增强人际温度。",
                deepAnalysis: [
                    "你拥有极强的组织和管理能力，善于建立规则和流程，确保团队高效运作。",
                    "你务实高效，注重结果和效率，不喜欢浪费时间在无意义的讨论和空想上。",
                    "你责任心强，敢于承担责任，在危机时刻能保持冷静并做出果断的决策。",
                    "你重视传统和规则，相信经验和实践的价值，是团队中稳定和可靠的领导者。"
                ],
                suitableFields: "企业管理、行政管理、军警、金融、销售管理、物流、工程管理等需要组织能力和决策能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ESFJ: {
                name: "执政官型 - 关怀的提供者",
                color: "#10B981",
                portrait: "你是一个热情体贴、善于社交的人，重视人际关系的和谐，乐于为他人提供帮助和支持。",
                strengths: ["热情体贴", "善于社交", "有责任感", "组织能力强"],
                weaknesses: ["过度付出", "害怕冲突", "缺乏主见", "在意他人评价"],
                suggestions: "学会关注自我需求，建立边界；相信自己的判断，减少对他人评价的依赖。",
                deepAnalysis: [
                    "你热情体贴，善于感知他人的需求和情绪，总是愿意伸出援手帮助身边的人。",
                    "你重视人际关系的和谐，会尽力维护团队的氛围，是天生的调和者和关怀者。",
                    "你拥有良好的组织能力和执行力，善于将想法转化为实际行动，确保事情顺利完成。",
                    "你在意他人的认可和评价，会尽力满足他人的期望，有时会忽略自己的真实需求。"
                ],
                suitableFields: "人力资源、教育、医疗、客服、行政管理、公关、销售、餐饮等需要社交能力和关怀能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ENFJ: {
                name: "教育家型 - 富有魅力的领导者",
                color: "#6366F1",
                portrait: "你是一个富有魅力、善于激励的人，重视他人的成长和发展，用热情和远见带领团队前进。",
                strengths: ["善于激励", "富有魅力", "有同理心", "理想主义"],
                weaknesses: ["过度付出", "情感敏感", "难以拒绝", "过于理想"],
                suggestions: "学会设定边界，保护自己的精力；平衡理想与现实，接受不完美。",
                deepAnalysis: [
                    "你拥有极强的感染力和激励能力，能激发他人的潜力和热情，是天生的领导者和教育家。",
                    "你富有同理心和洞察力，能理解他人的需求和动机，善于建立深度和有意义的人际关系。",
                    "你是理想主义者，有自己的价值观和信仰，愿意为了更高的目标和价值而努力。",
                    "你重视团队的和谐和成长，会尽力帮助每一个成员发挥自己的潜力，实现共同的目标。"
                ],
                suitableFields: "教育、心理咨询、企业管理、公关、公益、人力资源、培训、演讲等需要激励能力和共情能力的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            },
            ENTJ: {
                name: "指挥官型 - 大胆的领导者",
                color: "#EF4444",
                portrait: "你是一个果敢自信、富有远见的人，善于制定战略和决策，用实力和智慧引领团队走向成功。",
                strengths: ["战略思维", "果断决策", "自信满满", "执行力强"],
                weaknesses: ["过于强势", "缺乏耐心", "情感迟钝", "刚愎自用"],
                suggestions: "学会倾听他人意见，团队合作；关注他人情感，增强人际智慧。",
                deepAnalysis: [
                    "你拥有卓越的战略思维和领导能力，善于制定长远规划并带领团队实现目标。",
                    "你果断自信，能在压力下做出艰难的决策，并勇于承担决策带来的责任和后果。",
                    "你执行力强，注重结果和效率，不喜欢拖延和犹豫不决，能快速将想法转化为行动。",
                    "你有极高的标准和期望，不仅对自己要求严格，也希望身边的人能达到同样的水平。"
                ],
                suitableFields: "企业管理、创业、金融、战略规划、法律、军事、工程管理、咨询等需要领导能力和战略思维的领域。",
                bgImage: COMMON_BG_IMAGE_URL
            }
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 预加载图片解决保存时缺失问题（新增所有头像链接）
            const preloadImages = [
                COMMON_BG_IMAGE_URL,
                // 所有人格类型的头像
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/entp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/esfp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/estp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/infj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/intp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/isfp-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istj-g.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istp-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/istp-g.jpg',
                // 默认头像
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfj-b.jpg',
                'https://raw.githubusercontent.com/lannstore/MBTI-16personalities/refs/heads/main/images/enfj-g.jpg'
            ];
            const preloader = document.getElementById('image-preloader');
            preloadImages.forEach(url => {
                const img = new Image();
                img.src = url;
                img.crossOrigin = 'anonymous';
                preloader.appendChild(img);
            });

            // 首页开始按钮点击事件
            document.getElementById('start-btn').addEventListener('click', function() {
                document.getElementById('home-container').classList.add('hidden');
                document.getElementById('gender-container').classList.remove('hidden');
            });

            // 性别选择逻辑
            const maleOption = document.getElementById('male-option');
            const femaleOption = document.getElementById('female-option');
            const confirmGenderBtn = document.getElementById('confirm-gender-btn');

            // 男性选项点击
            maleOption.addEventListener('click', function() {
                maleOption.classList.add('selected');
                femaleOption.classList.remove('selected');
                selectedGender = 'male';
                confirmGenderBtn.disabled = false;
                confirmGenderBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            });

            // 女性选项点击
            femaleOption.addEventListener('click', function() {
                femaleOption.classList.add('selected');
                maleOption.classList.remove('selected');
                selectedGender = 'female';
                confirmGenderBtn.disabled = false;
                confirmGenderBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            });

            // 确认性别按钮点击
            confirmGenderBtn.addEventListener('click', function() {
                if (!selectedGender) return; // 确保已选择性别
                document.getElementById('gender-container').classList.add('hidden');
                document.getElementById('test-container').classList.remove('hidden');
                loadQuestion(currentQuestionIndex);
            });

            // 初始化测试页面
            function loadQuestion(index) {
                const question = questions[index];
                document.getElementById('question-number').textContent = `第 ${index + 1} 题 / 共 ${questions.length} 题`;
                document.getElementById('question-text').textContent = question.text;

                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';

                question.options.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option-hover bg-white rounded-2xl p-6 cursor-pointer border-2 border-transparent hover:border-primary transition-all';
                    optionElement.innerHTML = `
                        <div class="flex items-center">
                            <div class="ab-label rounded-full mr-4 flex items-center justify-center text-sm font-medium">
                                ${String.fromCharCode(65 + optionIndex)}
                            </div>
                            <span class="text-lg">${option.text}</span>
                        </div>
                    `;
                    
                    optionElement.addEventListener('click', () => selectOption(optionIndex));
                    optionsContainer.appendChild(optionElement);
                });
                
                updateProgress();
                updateNavigationButtons();
            }

            // 选项选择处理
            function selectOption(optionIndex) {
                const currentQuestion = questions[currentQuestionIndex];
                const selectedOption = currentQuestion.options[optionIndex];
                
                // 更新分数
                for (const [dimension, value] of Object.entries(selectedOption.score)) {
                    scores[dimension] += value;
                }
                
                userAnswers[currentQuestionIndex] = optionIndex;
                
                // 高亮选中的选项
                const options = document.querySelectorAll('#options-container > div');
                options.forEach((option, idx) => {
                    if (idx === optionIndex) {
                        option.classList.add('option-selected');
                    } else {
                        option.classList.remove('option-selected');
                    }
                });
                
                // 自动跳转到下一题（300ms延迟）
                if (autoNextTimer) {
                    clearTimeout(autoNextTimer);
                }
                
                autoNextTimer = setTimeout(() => {
                    if (currentQuestionIndex < questions.length - 1) {
                        currentQuestionIndex++;
                        loadQuestion(currentQuestionIndex);
                    }
                }, 300);
            }

            // 更新进度条
            function updateProgress() {
                const progressPercent = ((currentQuestionIndex + 1) / questions.length) * 100;
                document.getElementById('progress-bar').style.width = `${progressPercent}%`;
            }

            // 更新导航按钮状态
            function updateNavigationButtons() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                
                prevBtn.disabled = currentQuestionIndex === 0;
                nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? '提交结果' : '下一题';
                nextBtn.innerHTML = currentQuestionIndex === questions.length - 1 ? 
                    '<i class="fa fa-check mr-2"></i>提交结果' : 
                    '下一题<i class="fa fa-arrow-right ml-2"></i>';
            }

            // 上一题
            document.getElementById('prev-btn').addEventListener('click', function() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    loadQuestion(currentQuestionIndex);
                }
            });

            // 下一题/提交
            document.getElementById('next-btn').addEventListener('click', function() {
                if (currentQuestionIndex < questions.length - 1) {
                    if (userAnswers[currentQuestionIndex] !== null) {
                        currentQuestionIndex++;
                        loadQuestion(currentQuestionIndex);
                    } else {
                        alert('请选择一个选项！');
                    }
                } else {
                    // 最后一题，提交结果
                    if (userAnswers[currentQuestionIndex] !== null) {
                        calculateResult();
                    } else {
                        alert('请选择一个选项！');
                    }
                }
            });

            // 计算结果
            function calculateResult() {
                // 确定人格类型
                const type = 
                    (scores.E > scores.I ? 'E' : 'I') +
                    (scores.S > scores.N ? 'S' : 'N') +
                    (scores.T > scores.F ? 'T' : 'F') +
                    (scores.J > scores.P ? 'J' : 'P');
                
                currentPersonalityType = type;
                showResult(type);
            }

            // 显示结果
            function showResult(personalityType) {
                document.getElementById('test-container').classList.add('hidden');
                document.getElementById('result-container').classList.remove('hidden');
                
                const personalityData = personalityTypes[personalityType];
                
                // 设置结果内容
                document.getElementById('personality-title').textContent = personalityData.name;
                document.getElementById('personality-portrait').textContent = personalityData.portrait;
                document.getElementById('color-indicator').style.backgroundColor = personalityData.color;
                
                // 设置优势列表
                const strengthsList = document.getElementById('personality-strengths');
                strengthsList.innerHTML = '';
                personalityData.strengths.forEach(strength => {
                    const li = document.createElement('li');
                    li.textContent = strength;
                    strengthsList.appendChild(li);
                });
                
                // 设置不足列表
                const weaknessesList = document.getElementById('personality-weaknesses');
                weaknessesList.innerHTML = '';
                personalityData.weaknesses.forEach(weakness => {
                    const li = document.createElement('li');
                    li.textContent = weakness;
                    weaknessesList.appendChild(li);
                });
                
                // 设置深度分析
                const deepAnalysisDiv = document.getElementById('personality-deep-analysis');
                deepAnalysisDiv.innerHTML = '';
                personalityData.deepAnalysis.forEach(paragraph => {
                    const p = document.createElement('p');
                    p.textContent = paragraph;
                    deepAnalysisDiv.appendChild(p);
                });
                
                // 设置性格领域和改进建议
                document.getElementById('personality-suitable-fields').textContent = personalityData.suitableFields;
                document.getElementById('personality-suggestions').textContent = personalityData.suggestions;
                
                // 设置头像
                document.getElementById('personality-avatar').innerHTML = createAvatarImg(selectedGender, personalityType);
            }

            // 保存结果
            document.getElementById('save-btn').addEventListener('click', function() {
                const resultCard = document.getElementById('result-card-main');
                html2canvas(resultCard, {
                    useCORS: true,
                    scale: 2,
                    backgroundColor: null
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `我的MBTI人格-${currentPersonalityType}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            });

            // 重新开始
            document.getElementById('restart-btn').addEventListener('click', function() {
                // 重置所有变量
                currentQuestionIndex = 0;
                scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                userAnswers = new Array(36).fill(null);
                currentPersonalityType = '';
                selectedGender = '';
                
                // 清除选中的性别
                document.getElementById('male-option').classList.remove('selected');
                document.getElementById('female-option').classList.remove('selected');
                document.getElementById('confirm-gender-btn').disabled = true;
                document.getElementById('confirm-gender-btn').classList.add('opacity-50', 'cursor-not-allowed');
                
                // 返回首页
                document.getElementById('result-container').classList.add('hidden');
                document.getElementById('test-container').classList.add('hidden');
                document.getElementById('gender-container').classList.add('hidden');
                document.getElementById('home-container').classList.remove('hidden');
            });
        });
    </script>
</body>
</html>